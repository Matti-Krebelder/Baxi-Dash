<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pyropixle | Baxi Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" type="image/x-icon" href="https://baxi-backend.pyropixle.com/_images_/pyro.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div id="overlay">
        <iframe id="iframe" src="https://pyropixle.com/baxi_logon/"
            style="width: 100%; height: 100%; border: none;"></iframe>
    </div>
    <div class="sidebar">
        {% if guild_details %}
        {% for guild in guild_details %}
        <div class="server-icon" onclick="loadServerDetails('{{ guild.id }}')">
            <img src="{{ guild.icon_url }}" alt="{{ guild.name }}" />
            <span class="server-name">{{ guild.name }}</span>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="content">
        <h1>Baxi Dashboard</h1>
        <div id="menu-bar" class="menu-bar"></div>
        <div id="server-details" class="server-details"></div>
        <div class="error" style="display:none;">
            <div class="error__icon">
                <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="m13 13h-2v-6h2zm0 4h-2v-2h2zm-1-15c-1.3132 0-2.61358.25866-3.82683.7612-1.21326.50255-2.31565 1.23915-3.24424 2.16773-1.87536 1.87537-2.92893 4.41891-2.92893 7.07107 0 2.6522 1.05357 5.1957 2.92893 7.0711.92859.9286 2.03098 1.6651 3.24424 2.1677 1.21325.5025 2.51363.7612 3.82683.7612 2.6522 0 5.1957-1.0536 7.0711-2.9289 1.8753-1.8754 2.9289-4.4189 2.9289-7.0711 0-1.3132-.2587-2.61358-.7612-3.82683-.5026-1.21326-1.2391-2.31565-2.1677-3.24424-.9286-.92858-2.031-1.66518-3.2443-2.16773-1.2132-.50254-2.5136-.7612-3.8268-.7612z"
                        fill="#393a37"></path>
                </svg>
            </div>
            <div class="error__title">lorem ipsum dolor sit amet</div>
            <div class="error__close">
                <svg height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z"
                        fill="#393a37"></path>
                </svg>
            </div>
        </div>
        <div id="content-area" class="content-area">
            <label id="toggle-switch" class="switch" style="display: none;">
                <input type="checkbox" id="toggle-input" />
                <span class="slider"></span>
            </label>
            <div id="text-output" class="text-output"></div>
            <button id="save-button" style="display: none;" onclick="saveChanges()">Save</button>
        </div>
    </div>
    <!-- Api Endpoints -->
    <script id="menu-data" type="application/json">
        {
            "menu_items": [
                {
                    "name": "Anti Raid",
                    "id": "anti_raid",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/anti_raid/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/anti_raid/{guild_id}"
                    }
                },
                {
                    "name": "Minigame guessing",
                    "id": "Minigame guessing",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/mgg/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/mgg/{guild_id}"
                    }
                },
                {
                    "name": "Counting game",
                    "id": "countgame_data",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/mgc/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/mgc/{guild_id}"
                    }
                },
                {
                    "name": "Global chat",
                    "id": "gc",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/gc/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/gc/{guild_id}"
                    }
                },
                {
                    "name": "Welcome system",
                    "id": "welc",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/welc/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/welc/{guild_id}"
                    }
                },
                {
                    "name": "Verify system",
                    "id": "verify",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/verify/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/verify/{guild_id}"
                    }
                },
                {
                    "name": "Suggestion system",
                    "id": "Suggestions",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/sugg/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/sugg/{guild_id}"
                    }
                },
                {
                    "name": "Ticket system",
                    "id": "ticket",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/ticket/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/ticket/{guild_id}"
                    }
                },
                {
                    "name": "Log system",
                    "id": "log",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/log/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/log/{guild_id}"
                    }
                },
                {
                    "name": "Security system",
                    "id": "sec",
                    "endpoints": {
                        "load": "https://baxi-backend.pyropixle.com/api/dash/settings/load/sec/{guild_id}",
                        "save": "https://baxi-backend.pyropixle.com/api/dash/settings/save/sec/{guild_id}"
                    }
                }
            ]
        }
    </script>
    <script>
        const apiKey = 'bdash-X_KzUaBBMlM8d5a5xbAav4Z6bYqS3rnBN94ugjtkhsI';
        let currentData = {};

        function loadMenuContent() {
            const serverId = new URLSearchParams(window.location.search).get('server');
            if (!serverId) {
                document.getElementById('menu-bar').style.display = 'none';
                return;
            }
            document.getElementById('menu-bar').style.display = 'block';
            const menuData = JSON.parse(document.getElementById('menu-data').textContent);
            const menuBar = document.getElementById('menu-bar');

            menuData.menu_items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.textContent = item.name;
                menuItem.onclick = () => loadMenuItem(item, serverId);
                menuBar.appendChild(menuItem);
            });
        }

        function loadMenuItem(item, serverId) {
            document.getElementById('toggle-switch').style.display = 'none';
            document.getElementById('text-output').style.display = 'none';
            document.getElementById('save-button').style.display = 'none';

            fetch(item.endpoints.load.replace('{guild_id}', serverId), {
                headers: {
                    'Authorization': `Bearer ${apiKey}`
                }
            })
                .then(response => response.json())
                .then(data => {
                    currentData = data;
                    displayMenuContent(item, data);
                })
                .catch(error => {
                    console.error('Error loading menu item:', error);
                    document.querySelector('.error').style.display = 'block';
                    document.querySelector('.error__title').textContent = 'Failed to load data. Please try again later.';
                });
        }

        function displayMenuContent(item, data) {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = '';

            if (item.id === 'anti_raid' || item.id === 'gc') {
                document.getElementById('toggle-switch').style.display = 'block';
                document.getElementById('toggle-input').checked = data.enabled || false;
                document.getElementById('save-button').style.display = 'inline-block';
            } else if (item.id === 'Minigame guessing' || item.id === 'countgame_data') {
                document.getElementById('text-output').style.display = 'block';
                document.getElementById('text-output').textContent = data.message || '';
                document.getElementById('save-button').style.display = 'inline-block';
            } else {
                const textElement = document.createElement('pre');
                textElement.textContent = JSON.stringify(data, null, 2);
                contentArea.appendChild(textElement);
            }
        }

        function saveChanges() {
            const serverId = new URLSearchParams(window.location.search).get('server');
            const selectedItem = document.querySelector('.menu-item-selected');
            if (!selectedItem || !serverId) return;

            const menuItem = JSON.parse(document.getElementById('menu-data').textContent).menu_items.find(item => item.name === selectedItem.textContent);

            let dataToSave = {};

            if (menuItem.id === 'anti_raid' || menuItem.id === 'gc') {
                dataToSave = { enabled: document.getElementById('toggle-input').checked };
            } else if (menuItem.id === 'Minigame guessing' || menuItem.id === 'countgame_data') {
                dataToSave = { message: document.getElementById('text-output').textContent };
            } else {
                dataToSave = currentData;
            }

            fetch(menuItem.endpoints.save.replace('{guild_id}', serverId), {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dataToSave)
            })
                .then(response => {
                    if (!response.ok) throw new Error('Failed to save changes');
                    return response.json();
                })
                .then(data => {
                    console.log('Changes saved successfully:', data);
                })
                .catch(error => {
                    console.error('Error saving changes:', error);
                    document.querySelector('.error').style.display = 'block';
                    document.querySelector('.error__title').textContent = 'Failed to save changes. Please try again later.';
                });
        }

        window.onload = loadMenuContent;
    </script>
</body>

</html>


<style>
    .error {
        display: none;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  width: 320px;
  padding: 12px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: start;
  border-radius: 50px;
  background: -webkit-linear-gradient(to right, #f45c43, #eb3349);
  background: linear-gradient(to right, #f45c43, #eb3349);
  box-shadow: 0 0px 10px #de1c3280;
}

.error__icon {
  width: 20px;
  height: 20px;
  transform: translateY(-2px);
  margin-right: 8px;
  filter: drop-shadow(2px 1px 2px rgb(0 0 0 / 0.4));
}

.error__icon path {
  fill: #fff;
}

.error__title {
  font-weight: 500;
  font-size: 14px;
  color: #fff;
}

.error__close {
  width: 20px;
  height: 20px;
  cursor: pointer;
  margin-left: auto;
  filter: drop-shadow(2px 1px 2px rgb(0 0 0 / 0.4));
}

.error__close path {
  fill: #fff;
}
</style>